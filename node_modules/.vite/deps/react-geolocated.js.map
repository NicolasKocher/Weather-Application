{
  "version": 3,
  "sources": ["../../react-geolocated/dist-modules/index.js"],
  "sourcesContent": ["\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.useGeolocated = void 0;\r\nconst react_1 = require(\"react\");\r\n/**\r\n * Hook abstracting away the interaction with the Geolocation API.\r\n * @param config - the configuration to use\r\n */\r\nfunction useGeolocated(config = {}) {\r\n    const { positionOptions = {\r\n        enableHighAccuracy: true,\r\n        maximumAge: 0,\r\n        timeout: Infinity,\r\n    }, isOptimisticGeolocationEnabled = true, userDecisionTimeout = undefined, suppressLocationOnMount = false, watchPosition = false, geolocationProvider = typeof navigator !== \"undefined\"\r\n        ? navigator.geolocation\r\n        : undefined, watchLocationPermissionChange = false, onError, onSuccess, } = config;\r\n    const userDecisionTimeoutId = (0, react_1.useRef)(0);\r\n    const isCurrentlyMounted = (0, react_1.useRef)(true);\r\n    const watchId = (0, react_1.useRef)(0);\r\n    const [isGeolocationEnabled, setIsGeolocationEnabled] = (0, react_1.useState)(isOptimisticGeolocationEnabled);\r\n    const [coords, setCoords] = (0, react_1.useState)();\r\n    const [timestamp, setTimestamp] = (0, react_1.useState)();\r\n    const [positionError, setPositionError] = (0, react_1.useState)();\r\n    const [permissionState, setPermissionState] = (0, react_1.useState)();\r\n    const cancelUserDecisionTimeout = (0, react_1.useCallback)(() => {\r\n        if (userDecisionTimeoutId.current) {\r\n            window.clearTimeout(userDecisionTimeoutId.current);\r\n        }\r\n    }, []);\r\n    const handlePositionError = (0, react_1.useCallback)((error) => {\r\n        cancelUserDecisionTimeout();\r\n        if (isCurrentlyMounted.current) {\r\n            setCoords(() => undefined);\r\n            setIsGeolocationEnabled(false);\r\n            setPositionError(error);\r\n        }\r\n        onError === null || onError === void 0 ? void 0 : onError(error);\r\n    }, [onError, cancelUserDecisionTimeout]);\r\n    const handlePositionSuccess = (0, react_1.useCallback)((position) => {\r\n        cancelUserDecisionTimeout();\r\n        if (isCurrentlyMounted.current) {\r\n            setCoords(position.coords);\r\n            setTimestamp(position.timestamp);\r\n            setIsGeolocationEnabled(true);\r\n            setPositionError(() => undefined);\r\n        }\r\n        onSuccess === null || onSuccess === void 0 ? void 0 : onSuccess(position);\r\n    }, [onSuccess, cancelUserDecisionTimeout]);\r\n    const getPosition = (0, react_1.useCallback)(() => {\r\n        if (!geolocationProvider ||\r\n            !geolocationProvider.getCurrentPosition ||\r\n            !geolocationProvider.watchPosition) {\r\n            throw new Error(\"The provided geolocation provider is invalid\");\r\n        }\r\n        if (userDecisionTimeout) {\r\n            userDecisionTimeoutId.current = window.setTimeout(() => {\r\n                handlePositionError();\r\n            }, userDecisionTimeout);\r\n        }\r\n        if (watchPosition) {\r\n            watchId.current = geolocationProvider.watchPosition(handlePositionSuccess, handlePositionError, positionOptions);\r\n        }\r\n        else {\r\n            geolocationProvider.getCurrentPosition(handlePositionSuccess, handlePositionError, positionOptions);\r\n        }\r\n    }, [\r\n        geolocationProvider,\r\n        watchPosition,\r\n        userDecisionTimeout,\r\n        handlePositionError,\r\n        handlePositionSuccess,\r\n        positionOptions,\r\n    ]);\r\n    (0, react_1.useEffect)(() => {\r\n        let permission;\r\n        if (watchLocationPermissionChange &&\r\n            geolocationProvider &&\r\n            \"permissions\" in navigator) {\r\n            navigator.permissions\r\n                .query({ name: \"geolocation\" })\r\n                .then((result) => {\r\n                permission = result;\r\n                permission.onchange = () => {\r\n                    setPermissionState(permission.state);\r\n                };\r\n            })\r\n                .catch((e) => {\r\n                console.error(\"Error updating the permissions\", e);\r\n            });\r\n        }\r\n        return () => {\r\n            if (permission) {\r\n                permission.onchange = null;\r\n            }\r\n        };\r\n    }, []); // eslint-disable-line react-hooks/exhaustive-deps\r\n    (0, react_1.useEffect)(() => {\r\n        if (!suppressLocationOnMount) {\r\n            getPosition();\r\n        }\r\n        return () => {\r\n            cancelUserDecisionTimeout();\r\n            if (watchPosition && watchId.current) {\r\n                geolocationProvider === null || geolocationProvider === void 0 ? void 0 : geolocationProvider.clearWatch(watchId.current);\r\n            }\r\n        };\r\n    }, [permissionState]); // eslint-disable-line react-hooks/exhaustive-deps\r\n    return {\r\n        getPosition,\r\n        coords,\r\n        timestamp,\r\n        isGeolocationEnabled,\r\n        isGeolocationAvailable: Boolean(geolocationProvider),\r\n        positionError,\r\n    };\r\n}\r\nexports.useGeolocated = useGeolocated;\r\n"],
  "mappings": "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",
  "names": []
}
